---
title: "Reporte Hito 1"
output:
  html_document: 
    number_sections: yes
    theme: spacelab
    toc: yes
    df_print: default
  pdf_document:
    toc: yes
editor_options: 
  chunk_output_type: inline
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

# Introducción

## Contexto/Motivación

El mercado de los videojuegos, un área de interés común para los integrantes del grupo, ha crecido muchísimo en los últimos años. Esto se aprecia tanto al observar la cantidad de personas aficionadas a este hobby, la variedad de juegos publicados cada año, y los avances en gráficos y otras tecnologías que se ha logrado con el tiempo.

Resulta interesante además porque plataformas como Steam e Itch.io permiten que desarrolladores independientes o grupos pequeños de éstos puedan ser visibilizados y publicar sus juegos sin necesitar de grandes inversiones, volviendo alcanzable ingresar y/o dedicarse al área.

## Datos de estudio

El dataset escogido para el proyecto corresponde a información respecto a videojuegos recopilada de la plataforma Steam. Fue obtenido originalmente de [Kaggle](https://www.kaggle.com/nikdavis/steam-store-games).

## Planteamiento del problema

Por un lado, considerando que se ha presenciado en persona la evolución de los videojuegos, resulta atractiva la idea de encontrar (más allá de la impresión personal que se pueda tener) evidencia tangible de tendencias que se han dado respecto a los juegos con el paso de los años.

Observando lo vigente que resulta el área, y aprovechando la oportunidad del proyecto de este curso,  se aspirará también a identificar patrones que puedan resultar provechosos al momento de elegir ciertas características que tendrá un juego, tal que incluirlos pueda significar un mayor interés por parte del público.


# Exploración de datos

La descarga consta de 6 archivos, donde la información más importante respecto a los juegos se encuentra en `steam.csv`.

## Descripción

A continuación se describen los atributos de la tabla principal, `steam.csv`.

- **appid:** Identificador (único) de cada juego.
- **name:** Título del videojuego.
- **release_date:** Fecha de lanzamiento (formato AAAA-MM-DD).
- **english:** Si el juego fue lanzado o no en inglés (1 o 0).
- **developer:** Desarrolladores (separados con punto y coma en caso de haber más de uno).
- **publisher:** Distribuidores (separados con punto y coma).
- **required_age:** Edad mínima requerida para jugar, según rating PEGI UK (0 equivale a sin rating).
- **steamspy_tags:** Géneros a los que pertenece un juego según votación de la comunidad SteamSpy (separados con punto y coma).
- **achievements:** Número de logros que incluye el juego.
- **positive_ratings:** Cantidad de votos positivos otorgados.
- **negative_ratings:** Cantidad de votos negativos otorgados.
- **average_playtime:** Tiempo de juego promedio de los usuarios, en minutos.
- **median_playtime:** Mediana del tiempo de juego de los usuarios, en minutos.
- **owners:** Rangos estimados de la cantidad de usuarios que descargaron un juego.
- **price:** Precio estándar del juego (en GBP o libras esterlinas).

Para mayor facilidad en la interpretación de los precios fue necesario convertirlos a la moneda local (CLP). No confundir con los precios reales en la tienda de Chile.

Adicionalmente, existen otros atributos que de forma similar a las compañías desarrolladoras y distribuidoras, se encontraban separadas con punto y coma, pero al ser una cantidad de opciones más reducida, se decidió pre-procesar los datos y transformar cada uno de los atributos en columnas adicionales indicando si incluyen o no cierta característica, entre todas las opciones posibles. Corresponden a los siguientes:

- **platforms:** Plataformas (PC) soportadas.
- **categories:** Características adicionales de los juegos, como soporte de tecnologías y cantidad de jugadores permitidos.
- **genres:** Géneros con los que se clasificó el juego.

El dataset original no contiene elementos vacíos (NaN) y posee 27075 observaciones que corresponden a los juegos presentes en la plataforma steam.


## Preprocesamiento de la base de datos

```{r}

if (!require('tidyverse')) install.packages('tidyverse'); library('tidyverse')
if (!require('splitstackshape')) install.packages('splitstackshape'); library('splitstackshape')
  
steam <- read.csv("data/steam.csv", encoding = "UTF-8", as.is = F)

platforms <- str_split(steam$platforms, ";")
categories <- str_split(steam$categories, ";")
genres <- str_split(steam$genres, ";")

platforms <- unlist(platforms)
categories <- unlist(categories)
genres <- unlist(genres)

platforms <- unique(platforms)
categories <- unique(categories)
genres <- unique(genres)

steam <- cSplit(steam, "platforms", sep=";")
steam <- cSplit(steam, "categories", sep=";")
steam <- cSplit(steam, "genres", sep=";")

for (i in platforms){
  steam <- steam %>%
    mutate(!!i := if_any(starts_with("platforms"), ~ ifelse(.x == i,1,0))) 
}

for (i in categories){
  steam <- steam %>%
    mutate(!!i := if_any(starts_with("categories"), ~ ifelse(.x == i,1,0))) 
}

for (i in genres){
  steam <- steam %>%
    mutate(!!i := if_any(starts_with("genres"), ~ ifelse(.x == i,1,0))) 
}

GBP_TO_CLP_RATE <- 1085
steam$price <- round(steam$price * GBP_TO_CLP_RATE)

steam <- steam %>%
  mutate_at(c(53:113), ~ifelse(is.na(.x)==T | .x ==F,0,1))
```


## Atributos numéricos

Medidas de tendencia central, dispersión y rango de variables númericas.

```{r}
steam %>%
  select(achievements,positive_ratings,negative_ratings,average_playtime,median_playtime,
         price) %>%
  summary()
```
- Se observó que el atributo `english` no resultará muy útil pues casi todos los juegos están en inglés (lo que es esperable al ser Steam una plataforma originalmente en este idioma).
- La mayoría de los juegos tiene una cantidad baja de `achievements`, aunque existen algunos que parecieran enfocarse en lo contrario y presentan un número absurdamente alto de logros.
- Existe una clara tendencia a publicar opiniones positivas por sobre las negativas; en ambos casos habrá que tomar en cuenta una escala de `positive_ratings` y `negative_ratings` en caso de comparar juegos entre sí, pues sino los juegos "más populares" posiblemente terminarían opacando a los demás.
- Resulta interesante observar más de la mitad de los juegos agregados a las bibliotecas de los usuarios no son jugados: tanto `average_playtime` como `median_playtime` tienen mediana cero.
- La mayor parte de los juegos tienen bajos precios (75% bajo $8000 CLP).

Dado que buena parte de los valores de las variables `average_playtime` y `median_playtime` están fuertemente concentrados en 0, a continución se muestran
sus valores de tendencia central filtrando que sean mayor a cero (sólo para 
objetivos de análisis).

```{r}
steam %>%
  select(average_playtime,median_playtime) %>% 
  filter(average_playtime>0 & median_playtime>0) %>%
  summary()
```

### Achievements

Una enorme cantidad de juegos no tiene logros: un 43% del total.

```{r}
# Juegos sin achievements:
steam %>% filter(achievements==0) %>% nrow()
# Juegos con 1 o más achievements:
steam %>% filter(achievements!=0) %>% nrow()
```

Para estudiar un poco más la distribución de la cantidad de logros se descartaron los casos donde no habían. En general parecen centrarse alrededor de 20 logros. Se observa una pequeña tendencia de juegos con más logros a llegar a un número cerrado (50), pero fuera de esta anomalía lo esperable es que una mayor cantidad de logros se vuelve cada vez más inusual.

```{r}
ggplot(steam[steam$achievements<100 & steam$achievements>0,], aes(x = achievements)) +
  geom_density()
```

### Ratings

A continuación, se muestran los tabulados correspondientes a los 10 juegos con mayor cantidad de `positive_ratings`, de `negative_ratings` y también de una variable auxiliar `rating_neto` que corresponde a la diferencia entre los `positive_ratings` y `negative_ratings`.

```{r}
steam %>% 
  select(name,positive_ratings) %>%
  arrange(-positive_ratings) %>%
  head(10)
```
```{r}
steam %>% 
  select(name,negative_ratings) %>%
  arrange(-negative_ratings) %>%
  head(10)
```
```{r}
steam %>% 
  mutate(rating_neto = positive_ratings - negative_ratings) %>%
  select(name,rating_neto) %>%
  arrange(-rating_neto) %>%
  head(10)
```

### Tiempos de juego

A continuación se muestran los 10 juegos con mayor `average_playtine` y `median_playtime`. Cabe mencionar que los resultados obtenidos abren muchas dudas de la fiabilidad y validez de estas variables ya que luego de realizar un análisis cualitativo de varios de estos juegos pudimos concluir que no es esperable que posean tantas horas de juegos. Dado lo anterior, hemos decidido continuar con cautela respecto a estas variables y seguir investigando si pudiesen contener errores o outliers muy extremos.

```{r}
steam %>% 
  select(name,average_playtime) %>%
  arrange(-average_playtime) %>%
  head(10)
```
```{r}
steam %>% 
  select(name,median_playtime) %>%
  arrange(-median_playtime) %>%
  head(10)
```

### Precio

A continuación, se muestran los 10 juegos con mayor precio en steam y también se incluyen dos tablas de los 10 juegos gratis (precio = 0) con mayor cantidad de ratings positivos y negativos. 

```{r}
steam %>% 
  select(name,price) %>%
  arrange(-price) %>%
  head(10)
```
```{r}
steam %>% 
  filter(price == 0) %>%
  select(name,positive_ratings) %>%
  arrange(-positive_ratings) %>%
  head(10)
```
```{r}
steam %>% 
  filter(price == 0) %>%
  select(name,negative_ratings) %>%
  arrange(-negative_ratings) %>%
  head(10)
```
```{r , include=FALSE}
steam %>% 
  filter(price == 0) %>%
  mutate(rating_neto = positive_ratings - negative_ratings) %>%
  select(name,rating_neto) %>%
  arrange(-rating_neto) %>%
  head(10)
```


## Atributos Categóricos

### Año de lanzamiento

```{r , include=FALSE}
if (!require('lubridate')) install.packages('lubridate'); library('lubridate')

steam <- steam %>%
  mutate(release_date_lubridate = as_date(release_date)) %>%
  mutate(year = year(release_date_lubridate)) %>%
  mutate(month = month(release_date_lubridate))

steam %>%
  group_by(year) %>%
  summarise(n = n())

```

Vale la pena destacar que los datos consideran desde el año 1997 hasta 2019. Hay muy pocos juegos para los primeros años de la plataforma, así que se observó con mayor atención los años siguientes.

```{r}

steam %>%
  group_by(year) %>%
  summarise(n = n()) %>%
  ggplot(aes(x=year,y=n, label=n)) + geom_bar(stat = 'identity') +
  xlab("año") + 
  ylab("cantidad") +
  geom_text(vjust = -0.5, colour = "black", size = 2.5) 
```

Como los datos fueron recolectados en 2019, es esperable que no se tenga información completa respecto al último año; fuera de este caso, la cantidad de juegos lanzados parece aumentar cada año.

```{r}
# Confirmando el juego más reciente en la tabla (mes):
steam %>%
  filter(year==2019) %>% select(month) %>% arrange(-month) %>% head(1)
```

Bajo esta consideración, también puede resultar interesante ver cómo se distribuyen a través del año.

```{r}
steam %>%
  group_by(year, month) %>%
  summarise(n = n()) %>%
  ggplot(aes(x= as.factor(month), y=n, label=n)) + geom_bar(stat = 'identity') +
  xlab("mes") +
  ylab("cantidad") 
```

### Plataformas

En este apartado se puede ver la distribución de las plataformas a lo largo del dataframe steam.

```{r}
if (!require('reshape')) install.packages('reshape'); library('reshape')

steam %>%
  select(windows,mac,linux) %>%
  summarise_all(sum) %>%
  melt() %>%
  ggplot(aes(variable,value, label = value)) + 
  geom_bar(stat = 'identity') +
  geom_text(vjust = 4, colour = "white") +
  xlab("plataformas") +
  ylab("cantidad")
```

Solo hay 3 plataformas en PC, siendo liderado por Windows.

```{r}

steam %>%
  mutate(aux_excl = windows + mac + linux) %>%
  mutate(windows_excl = ifelse(windows == 1 & aux_excl == 1,1,0),
         mac_excl = ifelse(mac == 1 & aux_excl == 1,1,0),
         linux_excl = ifelse(linux == 1 & aux_excl == 1,1,0)) %>%
  select(windows_excl,mac_excl,linux_excl) %>%
  summarise_all(sum) %>%
  melt()

```

Más aún, prácticamente nadie crea contenido exclusivo para Mac o Linux. Lo común es que los desarrolladores liberen sus juegos en Windows, y en ocasiones también deciden agregar otras plataformas.


### Desarrolladores

```{r}
steam %>% select(developer) %>% unique() %>% nrow()
```
Existen muchísimos desarrolladores en Steam; posiblemente la mayoría de estos solo publican un único juego:

```{r}
steam %>% 
  group_by(developer) %>%
  summarise(n = n()) %>%
  filter(n==1) %>%
  nrow()
```
Por su parte, algunos de los desarrolladores que producen más contenido son:

```{r}
steam %>% 
  group_by(developer) %>%
  summarise(n = n()) %>%
  arrange(-n) %>%
  head(10)
```

### Distribuidores

```{r}
steam %>% select(publisher) %>% unique() %>% nrow()
```

Las compañías distribuidoras también son muchísimas como para analizarlas individualmente. Se comporta de forma similar a los desarrolladores: gran parte de ellos se asocia solo a un juego.

```{r}
steam %>% 
  group_by(publisher) %>%
  summarise(n = n()) %>%
  filter(n==1) %>%
  nrow()
```
Algunas de las distribuidoras con más juegos a su nombre son:

```{r}
steam %>% 
  group_by(publisher) %>%
  summarise(n = n()) %>%
  arrange(-n) %>%
  head(10)
```

### Edad requerida

Existen un total de 6 categorías según el sistema inglés.

```{r}
unique(steam$required_age)
```

La mayor parte de los juegos no indican un rating:

```{r}
steam %>% count(required_age)
```

Sin embargo, esto puede deberse a que solo es importante etiquetarlos cuando se trata de juegos para mayores de edad, y que por eso la tendencia sea a aumentar la cantidad con el rating de edad.


### Categorías

Existe un total de 29 categorías únicas:

```{r}
categories
```
Algunas de las más frecuentes son:

```{r}
steam %>%
  select(55:83) %>%
  summarise_all(sum) %>%
  melt() %>%
  arrange(-value) %>%
  head(10)
```

### Géneros

También se identificaron un total de 29 géneros distintos:

```{r}
genres
```

Algunos de los anteriores corresponden a géneros de software y no necesariamente de juegos. Sin embargo, los más frecuentes se corresponden con géneros más bien conocidos de videojuegos.

```{r}
(popular_genres <- steam %>% 
  select(84:112) %>%
  summarise_all(sum) %>%
  melt() %>%
  arrange(-value) %>%
  head(15))
```

### Cantidad de dueños

Para distinguir de mejor forma los grupos se prefirió convertir el valor a numérico promediando ambos límites del rango entregado originalmente (`dueños promedio`).

```{r}
owners <- str_split(steam$owners, "-")
owners <- unlist(owners)
owners <- unique(owners)
steam <- cSplit(steam, "owners", sep="-")

steam <- steam %>%
  mutate(duenos_promedio = (owners_1 + owners_2)/2)
```

Sin embargo, para conocer cuántos juegos hay por rango:

```{r}
owners_lbl <- c("0-20k", "20k-50k", "50k-100k", "100k-200k", "200k-500k", "500k-1M", "1M-2M", "2M-5M", "5M-10M", "10M-20M", "20M-50M", "50M-100M", "100M-200M")
steam %>%
  group_by(duenos_promedio) %>%
  summarise(n=n()) %>%
  ggplot() +
  scale_y_log10() +
  geom_bar(aes(x=as.factor(duenos_promedio), y=n), stat="identity") +
  scale_x_discrete(labels=owners_lbl) +
  ylab("cantidad") +
  xlab("rangos de cantidad de dueños") +
  coord_flip()
```

## Analizando relaciones

### Precio vs Cantidad de dueños

```{r}
steam %>% 
  filter(price < 50000 & duenos_promedio < 50000000 & duenos_promedio > 0) %>%
  ggplot(aes(x=log(price),y=log(duenos_promedio))) +
  geom_point(aes(alpha=0.05), show.legend = F) +
  xlab("precio (CLP)") +
  ylab("log(dueños promedio)")
```

En general, los juegos tienden a tener precios bajos; conforme crecen tienden a agruparse en ciertos precios "estándar". Por otro lado, los juegos con más descargas son gratis, concentrándose hacia precios cada vez más pequeños conforme aumentan los rangos de dueños. A pesar de lo anterior, no se aprecia una correlación clara entre las variables.

### Precio vs Ratings positivos

En este apartado se utilizan transformaciones logarítmicas para suavizar las observaciones y distribuciones.

```{r}
steam %>% 
  filter(price<100000) %>%
  ggplot(aes(x=log(price),y=log(positive_ratings))) +
  geom_point() + 
  xlab("precio (CLP)") +
  ylab("log(ratings positivos)")
```

Al igual que en el ejemplo anterior no se aprecia una correlación clara entre `log(precio)` y `log(ratings_positivos)` y si la hubiera, pareciera ser levemente positiva entre las dos variables.

### Desarrolladores más elogiados

```{r}
steam %>% 
  group_by(developer) %>%
  summarise(media_pos = mean(positive_ratings)) %>%
  arrange(-media_pos) %>%
  head(10)
```

### Desarrolladores más criticados

```{r}
steam %>% 
  group_by(developer) %>%
  summarise(media_neg = mean(negative_ratings)) %>%
  arrange(-media_neg) %>%
  head(10)
```

### Géneros más caros

```{r}
steam %>%
  select(c(1,84:112,14)) %>%
  melt(id = c("appid","price")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_precio_genero = mean(price)) %>%
  arrange(-media_precio_genero) %>%
  head(10)
```

```{r}
steam %>%
  select(c(1,84:112,14)) %>%
  melt(id = c("appid","price")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_precio_genero = mean(price)) %>%
  arrange(-media_precio_genero) %>%
  head(10) %>%
  ggplot(aes(reorder(variable,-media_precio_genero),media_precio_genero)) +
  geom_bar(stat = 'identity') +theme(axis.text.x = element_text(angle = 90)) +
  xlab("géneros") +
  ylab("precio medio")
```

### Géneros más económicos

```{r}
steam %>%
  select(c(1,84:112,14)) %>%
  melt(id = c("appid","price")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_precio_genero = mean(price)) %>%
  arrange(media_precio_genero) %>%
  head(10)
```

```{r}

steam %>%
  select(c(1,84:112,14)) %>%
  melt(id = c("appid","price")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_precio_genero = mean(price)) %>%
  arrange(media_precio_genero) %>%
  head(10) %>%
  ggplot(aes(reorder(variable,media_precio_genero),media_precio_genero)) +
  geom_bar(stat = 'identity') +theme(axis.text.x = element_text(angle = 90)) +
  xlab("géneros") +
  ylab("precio medio")
  
```

Algo particular de notar es que los juegos "free to play" tienen muy bajos precios pero se esperaría que fueran totalmente gratis (es decir, iguales a 0). Analizando un poco más detalle podemos ver que los 5 juegos más caros de la categoría "free to play" presentan precios bastantes más altos que 0. Esto nos lleva a pensar que puede estar ocurriendo que ciertas etiquetas de género estén mal identificadas o que existen juegos que hayan cambiado de género pero que el cambio no se haya visto reflejado en la base de datos.

```{r}
steam %>% 
  filter(`Free to Play` == 1) %>%
  select(name,price) %>%
  arrange(-price) %>%
  head(5)
```


### Géneros más descargados

```{r}
steam %>%
  select(c(1,84:112,118)) %>%
  melt(id = c("appid","duenos_promedio")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_duenos_genero = mean(duenos_promedio)) %>%
  arrange(-media_duenos_genero) %>%
  head(10)
  
```


### Géneros menos descargados

```{r}
steam %>%
  select(c(1,84:112,118)) %>%
  melt(id = c("appid","duenos_promedio")) %>%
  filter(value ==1) %>%
  group_by(variable) %>%
  summarise(media_duenos_genero = mean(duenos_promedio)) %>%
  arrange(media_duenos_genero) %>%
  head(10)
  
```


### Correlaciones lineales

```{r}
if (!require('corrplot')) install.packages('corrplot'); library('corrplot')

steam %>%
  mutate(rating_neto = positive_ratings - negative_ratings) %>%
  select(positive_ratings,negative_ratings,rating_neto,average_playtime,median_playtime,
         price,duenos_promedio) %>%
  cor() 
```
```{r}

steam %>%
  mutate(rating_neto = positive_ratings - negative_ratings) %>%
  select(positive_ratings,negative_ratings,rating_neto,average_playtime,median_playtime,
         price,duenos_promedio) %>%
  cor() %>%
  corrplot()
```

Con la información anterior podemos notar que la variable `price` no está fuertemente correlacionada con ninguna variable. Por otro lado, un aspecto interesante es el hecho que la cantidad de dueños promedio está fuertemente correlacionada positivamente con las variables de ratings. Esto hace concluir que la cantidad de ratings (ya sean positivos o negativos) podrían estar reflejando la popularidad de los juegos.

### Precios de géneros de juego

```{r}
steam %>%
  select(appid,price,Indie,Action,Casual,Adventure,Strategy) %>%
  melt(id = c("appid","price")) %>%
  group_by(variable) %>%
  filter(value == 1 & price<=20000) %>%
  ggplot(aes(variable,price)) + 
  geom_boxplot() +
  xlab("géneros") +
  ylab("precio")
```

### Cantidad de juegos de un género por año

```{r}
if (!require('plotly')) install.packages('plotly'); library('plotly')

steam %>% 
  select(appid,price,year,duenos_promedio,Indie,Action,Casual,Adventure,Strategy) %>%
  melt(id = c("appid","price","year","duenos_promedio")) %>%
  filter(value == 1 & year >=2006) %>%
  group_by(variable, year) %>%
  summarise(q_juegos = n()) %>%
  plot_ly(x=~year ,y = ~q_juegos,group = ~variable, color = ~variable ,type = "scatter" ,mode='lines+markers') %>%
  layout(xaxis=list(title="año"), yaxis=list(title="cantidad"))
```

### Precios de géneros de juego por año

```{r}
steam %>% 
  select(appid,price,year,duenos_promedio,Indie,Action,Casual,Adventure,Strategy) %>%
  melt(id = c("appid","price","year","duenos_promedio")) %>%
  filter(value == 1 & year >=2006) %>%
  group_by(variable, year) %>%
  summarise(media_duenos = mean(duenos_promedio)) %>%
  plot_ly(x=~year ,y = ~media_duenos,group = ~variable, color = ~variable ,type = "scatter" ,mode='lines+markers') %>% layout(xaxis = list(range=c(2006,2020))) %>%
  layout(xaxis=list(title="año"), yaxis=list(title="cantidad de dueños media"))
```

### Variación de dueños promedio por año de lanzamiento

```{r}
steam %>% 
  select(appid,price,year,duenos_promedio,Indie,Action,Casual,Adventure,Strategy) %>%
  melt(id = c("appid","price","year","duenos_promedio")) %>%
  filter(value == 1 & year >=2007) %>%
  group_by(variable, year) %>%
  summarise(media_duenos = mean(duenos_promedio)) %>%
  plot_ly(x=~year ,y = ~media_duenos,group = ~variable, color = ~variable ,type = "scatter" ,mode='markers', frame = ~year, size = 10) %>%
  layout(xaxis=list(title="año"), yaxis=list(title="cantidad de dueños media"))
```


# Preguntas y problemas

1. ¿Cómo ha evolucionado la cantidad de juegos que lanzan los desarrolladores en el tiempo?

2. ¿Cómo decidir que un juego es/será popular entre los jugadores?

3. ¿Qué factores afectan más en producir altos tiempos de juego? (cantidad de achievements o juegos multiplayer por ejemplo)

4. ¿Cuáles son los géneros de juegos indie que producen más engagement? (mayores playtimes y más owners)

